
name: 'powershell module push'

trigger:
  branches:
    include:
    - releases/*

pr:
  branches:
    exclude:
    - '*'
     
variables:
  - group: 'orch-key-vault-dev'
  - name: 'onPremWindowsAgent'
    value: 'DsbWindowsAgents'
  - name: 'powershellModuleName'
    value: 'DsbRobotOrchestration'

jobs:
- job: PublishModule
  displayName: Publish module to Powershell gallery
  pool:
    name: $(onPremWindowsAgent)
  steps:
  - powershell: |
      Publish-Module -Path $(Build.Repository.LocalPath)\$(powershellModuleName) -NugetApiKey $env:GALLERY_TOKEN  
    displayName: 'PowerShell Gallery Packager '
    env:
      GALLERY_TOKEN: $(powershell-gallery-token)