
name: 'powershell module push'

trigger:
  branches:
    include:
    - releases/*

pr:
  branches:
    exclude:
    - '*'
     
variables:
  - group: 'orch-key-vault-dev'
  - name: 'onPremWindowsAgent'
    value: 'DsbWindowsAgents'
  - name: 'powershellModuleName'
    value: 'DsbRobotOrchestration'

jobs:
- job: PublishModule
  displayName: Publish module to Powershell gallery
  pool:
    name: $(onPremWindowsAgent)
  variables: 
    - name: GALLERY_TOKEN 
      value: $(powershell-gallery-token)
  steps:
  - task: kenakamu.PSGalleryPublisher.powershell-gallery-publish-task.PSGalleryPackager@0
    displayName: 'PowerShell Gallery Packager '
    inputs:
      apiKey: $(GALLERY_TOKEN)
      path: $(Build.Repository.LocalPath)\$(powershellModuleName)